!function(e,t){if("function"==typeof define&&define.amd)define(["underscore","backbone"],function(i,o){return o.ModelComposite=t(e,i,o),o.ModelComposite});else if("undefined"!=typeof exports){var i=require("underscore"),o=require("backbone");exports=o.ModelComposite=t(e,i,o)}else e.Backbone.ModelComposite=t(e,e._,e.Backbone)}(this,function(e,t,i){var o=Array.prototype.slice,s=i.Model.extend({childModels:{},constructor:function(e,t){i.Model.apply(this,arguments),this._createChildren(t)},set:function(e,o,s){i.Model.prototype.set.apply(this,arguments);var n;return"object"==typeof e?(n=e,s=o):(n={})[e]=o,s&&s.excludeChildModels||t.each(t.keys(t.result(this,"childModels")),function(e){n[e]&&this[e].set(n[e],s)},this),this},toJSON:function(e){e=e||{};var o=i.Model.prototype.toJSON.apply(this,arguments);if(!e.excludeChildModels){var s=t.result(this,"childModels"),n=t.keys(s);t.each(n,function(t){o[t]=this[t].toJSON(e)},this)}return o},_createChildren:function(e){e=e||{};var i=t.result(this,"childModels");t.each(i,function(t,i){var o=new t(this.get(i));this._propagateChildEvents(o,i),this[i]=o,e.preserveChildAttributes||this.unset(i)},this)},_propagateChildEvents:function(e,t){this.listenTo(e,"all",function(){var e=o.apply(arguments),i=e[0];e[0]=t+":"+i,this.trigger.apply(this,e)})}});return s.VERSION="1.0.2",s});